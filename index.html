<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ã‚¤ãƒ ã‚·ãƒ§ãƒƒã‚¯ ãƒãƒ¼ã‚ºå½“ã¦ã‚²ãƒ¼ãƒ ï¼ˆiPhoneæœ€é©åŒ–ï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    background:#fff;
    text-align:center;
    margin:0;
    font-family:-apple-system;
    overflow-x:hidden;
  }

  h2 { margin:12px 0 4px; font-size:22px; font-weight:bold; }

  /* ğŸ”¥ ã‚­ãƒ£ãƒ³ãƒã‚¹ï¼ˆç¸®å°å¯¾è±¡ãƒ»ç”»åƒã‚µã‚¤ã‚ºã¯ãã®ã¾ã¾ï¼‰ */
  #gameCanvas{
    background:#fff;
    display:block;
    margin:15px auto 0;
    border:2px solid #ddd;
    border-radius:10px;
    width:400px;
    height:650px;
  }

  /* ğŸ“± iPhoneè¡¨ç¤ºæ™‚ã¯è‡ªå‹•ã§å…¨ä½“ç¸®å°ï¼ˆç”»åƒã¯å®Ÿå¯¸ã®ã¾ã¾ï¼‰ */
  @media (max-width: 430px){
    #gameCanvas{
      transform: scale(.82); /* â†ã“ã®æ•°å­—ã ã‘ã§ç¸®å°ç‡èª¿æ•´å¯èƒ½ */
      transform-origin: top center;
    }
  }

  #info{font-size:15px;margin-top:4px;}
  #message{margin-top:4px;font-size:14px;font-weight:600;min-height:1.4em;}

  button{
    margin-top:12px;
    padding:12px 24px;
    font-size:20px;
    border-radius:50px;
    background:#000;
    color:#fff;
    border:none;
  }
</style>
</head>
<body>

<h2>â–¶ ã‚¿ã‚¤ãƒ ã‚·ãƒ§ãƒƒã‚¯ ãƒãƒ¼ã‚ºå½“ã¦ã‚²ãƒ¼ãƒ </h2>
<canvas id="gameCanvas" width="400" height="650"></canvas>

<div id="info">ãƒ©ã‚¦ãƒ³ãƒ‰ï¼š<span id="round">0</span> / 5ã€€ã‚¹ã‚³ã‚¢ï¼š<span id="score">0</span> ç‚¹</div>
<div id="message">ç”»åƒèª­ã¿è¾¼ã¿ä¸­â€¦</div>

<button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ / ãƒªãƒˆãƒ©ã‚¤</button>

<script>
/* === åŸºæœ¬è¨­å®š === */
const cvs=document.getElementById("gameCanvas");
const ctx=cvs.getContext("2d");

const pose=new Image(); pose.src="pose.png";       // â†ç”»åƒãã®ã¾ã¾å¤§
const se=new Audio("timeshock.mp3");               // â†ä¸€è‡´æ™‚ã®éŸ³å£°

let loaded=false,playing=false,round=0,total=0;
const MAX=5;

/* ğŸ”¥ ç”»åƒã¯ç¸®å°ã›ãšå¤§ãã„ã¾ã¾ç¶­æŒ */
let w=360, h=600;
const centerX=cvs.width/2;
let x=0;

/* â†“ ã‚­ãƒ£ãƒ³ãƒã‚¹ç¸®å°ã«åˆã‚ã›ãŸè‡ªç„¶ãªã‚ªãƒ•ã‚»ãƒƒãƒˆ */
const baseY=(cvs.height - h)/2 + 25;

pose.onload=()=>{loaded=true;msg("ã‚¹ã‚¿ãƒ¼ãƒˆã§é–‹å§‹ï¼");draw();}

/* === æç”» === */
function draw(){
  ctx.clearRect(0,0,cvs.width,cvs.height);

  // ã‚¬ã‚¤ãƒ‰
  ctx.strokeStyle="rgba(0,0,0,0.12)";
  ctx.beginPath(); ctx.moveTo(centerX,0); ctx.lineTo(centerX,cvs.height); ctx.stroke();

  // è–„ã„ã‚·ãƒ«ã‚¨ãƒƒãƒˆï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼‰
  ctx.globalAlpha=0.22;
  ctx.drawImage(pose,centerX-w/2,baseY,w,h);
  ctx.globalAlpha=1;

  // å‹•ãç”»åƒï¼ˆã‚»ãƒ³ã‚¿ãƒ¼åŸºæº–ï¼‰
  ctx.drawImage(pose,x-w/2,baseY,w,h);
}

let speed=4;

/* === ãƒ«ãƒ¼ãƒ— === */
function loop(){
  if(!playing)return;
  x+=speed;
  if(x>cvs.width+w/2) x=-w/2;
  draw(); requestAnimationFrame(loop);
}

/* === ã‚²ãƒ¼ãƒ é–‹å§‹ === */
function start(){
  if(!loaded)return alert("èª­ã¿è¾¼ã¿ä¸­");
  round=0; total=0; update();
  next();
}

/* === Rã”ã¨ === */
function next(){
  round++; if(round>MAX)return end();
  msg(`ãƒ©ã‚¦ãƒ³ãƒ‰${round} â†’ ä¸­å¤®ã§æ­¢ã‚ã‚!`);
  x=-200; speed=3+round*0.8;
  playing=true; loop();
}

/* === åœæ­¢åˆ¤å®š === */
function stop(){
  if(!playing)return;
  playing=false;

  let diff=Math.abs(x-centerX);
  let score= diff<10?100 : diff<28?70 : diff<50?40 :10;
  total+=score; update();

  if(score===100){
    msg("ğŸ”¥ å®Œå…¨ä¸€è‡´ï¼ +100");
    se.currentTime=0; se.play();
  }else msg(`+${score}ç‚¹`);

  if(round<MAX) setTimeout(next,900);
  else setTimeout(end,900);
}

/* === END === */
function end(){ playing=false; msg(`ğŸ‰çµ‚äº†ï¼åˆè¨ˆ ${total} ç‚¹`); }

/* === è¡¨ç¤º === */
function msg(t){ document.getElementById("message").textContent=t; }
function update(){ document.getElementById("score").textContent=total; document.getElementById("round").textContent=round; }

/* === æ“ä½œ === */
startBtn.onclick=start;
cvs.onclick=stop;
onkeydown=e=>{ if(e.code==="Space")stop(); }
</script>

</body>
</html>
