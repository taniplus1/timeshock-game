<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ã‚¤ãƒ ã‚·ãƒ§ãƒƒã‚¯ ãƒãƒ¼ã‚ºå½“ã¦ã‚²ãƒ¼ãƒ ï¼ˆå®Œæˆç‰ˆï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { 
    background:#ffffff;
    text-align:center;
    margin:0; 
    font-family:-apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
  }
  h2 { margin:12px 0 0; font-size:22px; font-weight:700; }
  #gameCanvas{
    background:#fff;
    display:block;
    margin:15px auto 0;
    border:2px solid #ddd;
    border-radius:10px;
  }
  #info{ font-size:15px; margin-top:6px; }
  #message{ margin-top:4px; min-height:1.4em; font-size:14px; font-weight:600; }

  button{
    margin-top:12px;
    padding:12px 24px;
    font-size:20px;
    border-radius:50px;
    background:#111;
    color:#fff;
    border:none;
    cursor:pointer;
  }
  button:active { transform:scale(0.97); }
</style>
</head>
<body>

<h2>â–¶ ã‚¿ã‚¤ãƒ ã‚·ãƒ§ãƒƒã‚¯ ãƒãƒ¼ã‚ºå½“ã¦ã‚²ãƒ¼ãƒ </h2>

<canvas id="gameCanvas" width="400" height="650"></canvas>

<div id="info">
  ãƒ©ã‚¦ãƒ³ãƒ‰ï¼š<span id="round">0</span> / 5ã€€
  ã‚¹ã‚³ã‚¢ï¼š<span id="score">0</span> ç‚¹
</div>
<div id="message">ç”»åƒèª­ã¿è¾¼ã¿ä¸­â€¦</div>

<button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ / ãƒªãƒˆãƒ©ã‚¤</button>

<script>
/* === è¨­å®š === */
const cvs = document.getElementById("gameCanvas");
const ctx = cvs.getContext("2d");

const pose = new Image();
pose.src="pose.png";           // â† åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ç½®ã
const se_timeshock=new Audio("timeshock.mp3"); // â† å®Œå…¨ä¸€è‡´æ™‚é³´ã‚‹éŸ³

const MAX_ROUNDS=5;

/* === çŠ¶æ…‹ === */
let loaded=false, playing=false, round=0, totalScore=0;

/* === ç”»åƒã‚µã‚¤ã‚º & ä¸­å¤®é…ç½® === */
let w=310, h=600;          // â† ç”»åƒå¤§ãã‚
let x=0;                   // å‹•ãã®ä¸­å¿ƒåº§æ¨™ã§æ‰±ã†
const centerX=cvs.width/2; // çµ¶å¯¾ã‚»ãƒ³ã‚¿ãƒ¼åŸºæº–
const baseY=110;           // ä¸Šã‚ã«é…ç½®ã—ç”»é¢ã«åã‚ã‚‹

/* === UIå–å¾— === */
const roundEl=document.getElementById("round");
const scoreEl=document.getElementById("score");
const msgEl=document.getElementById("message");
const startBtn=document.getElementById("startBtn");

/* === ç”»åƒèª­ã¿è¾¼ã¿ === */
pose.onload=()=>{ loaded=true; msgEl.textContent="ã‚¹ã‚¿ãƒ¼ãƒˆã§é–‹å§‹ï¼"; draw(); };

/* === æç”» === */
function draw(){
  ctx.clearRect(0,0,cvs.width,cvs.height);

  // ä¸­å¤®ã‚¬ã‚¤ãƒ‰ç·š
  ctx.strokeStyle="rgba(0,0,0,0.12)";
  ctx.beginPath();
  ctx.moveTo(centerX,0);
  ctx.lineTo(centerX,cvs.height);
  ctx.stroke();

  // ä¸­å¤®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼ˆè–„ãï¼‰
  ctx.globalAlpha=0.23;
  ctx.drawImage(pose,centerX-w/2,baseY,w,h);
  ctx.globalAlpha=1;

  // å‹•ãåƒï¼ˆä¸­å¤®åŸºæº–ï¼‰
  ctx.drawImage(pose,x-w/2,baseY,w,h);
}

/* === ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ === */
function loop(){
  if(!playing)return;
  x+=speed;
  if(x>cvs.width+w/2)x=-w/2; // ç”»é¢å¤–ã¸è¡Œã£ãŸã‚‰ãƒ«ãƒ¼ãƒ—
  draw();
  requestAnimationFrame(loop);
}

/* === ã‚²ãƒ¼ãƒ é–‹å§‹ === */
function startGame(){
  if(!loaded) return alert("ã¾ã ç”»åƒèª­ã¿è¾¼ã¿ä¸­ã§ã™");
  round=0; totalScore=0;
  scoreEl.textContent=totalScore;
  nextRound();
}

/* === ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹ === */
let speed=4;
function nextRound(){
  round++;
  if(round>MAX_ROUNDS)return endGame();

  roundEl.textContent=round;
  msgEl.textContent=`ãƒ©ã‚¦ãƒ³ãƒ‰${round} â–· ä¸­å¤®ã§æ­¢ã‚ã‚ï¼`;

  x=-200;
  speed=3+round*0.8; // ãƒ©ã‚¦ãƒ³ãƒ‰ã”ã¨åŠ é€Ÿ
  playing=true;
  loop();
}

/* === åœæ­¢åˆ¤å®š === */
function stopAndJudge(){
  if(!playing) return;
  playing=false;

  const diff=Math.abs(x-centerX);

  // åˆ¤å®š
  let score = diff< 10?100 :
              diff< 25?70 :
              diff< 45?40 :10;

  totalScore+=score;
  scoreEl.textContent=totalScore;

  // å®Œå…¨ä¸€è‡´ãªã‚‰éŸ³å£°ï¼
  if(score===100){
    msgEl.textContent="ğŸ”¥ å®Œå…¨ä¸€è‡´ï¼ +100";
    se_timeshock.currentTime=0;
    se_timeshock.play();
  }else{
    msgEl.textContent = `+${score}ç‚¹`;
  }

  // æ¬¡ãƒ©ã‚¦ãƒ³ãƒ‰ã¸
  if(round<MAX_ROUNDS) setTimeout(nextRound,900);
  else setTimeout(endGame,900);
}

/* === çµ‚äº† === */
function endGame(){
  playing=false;
  msgEl.textContent=`ğŸ‰çµ‚äº†ï¼ åˆè¨ˆ ${totalScore} ç‚¹ï¼`;
}

/* === æ“ä½œ === */
startBtn.onclick=startGame;
cvs.onclick=stopAndJudge;
onkeydown=e=>{ if(e.code==="Space") stopAndJudge(); }
</script>

</body>
</html>
